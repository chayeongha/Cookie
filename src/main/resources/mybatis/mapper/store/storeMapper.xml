<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
  <mapper namespace="com.cookie.basic.store.StoreMapper">

  	<insert id="storeInsert" parameterType="StoreVO" useGeneratedKeys="true" keyProperty="ssNum">
  			insert into store values(0,#{sName},#{sTel},#{roadFullAddr},#{sNotice},0,#{memNum},#{memId})
  	</insert>
  	
  	<update id="storeUpdate" parameterType="StoreVO">
  		update store set sName=#{sName}, sTel=#{sTel}, roadFullAddr=#{roadFullAddr} where ssNum=#{ssNum}
  	</update>
  	
  	<select id="sNumSearch" parameterType="StoreVO" resultMap="storeResult">
  		select * from store S left outer join storeFiles F 
  		on S.ssNum = F.ssNum  
  		where sName=#{sName}
  	</select>
  	  	
  	  	
  	<select id="info" parameterType="StoreVO" resultMap="storeResult">
  		select * from store S left outer join storeFiles F 
  		on S.ssNum = F.ssNum  		
  		where S.ssNum = #{ssNum}
  	</select>
  	
  	
  	<resultMap type="StoreVO" id="storeResult">
  		<id column="ssNum" property="ssNum"/>
  		<result column="sName" property="sName"/>
  		<result column="sTel" property="sTel"/>
  		<result column="roadFullAddr" property="roadFullAddr"/>
  		<result column="sNotice" property="sNotice"/>
  		<result column="sOn" property="sOn"/>
  		<result column="memNum" property="memNum"/>
  		<result column="memId" property="memId"/>
  		<association property="storeFilesVO" javaType="StoreFilesVO">
  			<id column="fNum" property="fNum"/>
  			<result column="fName" property="fName"/>
  			<result column="oName" property="oName"/>  		
  		</association>
  	</resultMap>
  	
 
  	<select id="searchInfo" parameterType="StoreVO" resultMap="storeResult">
  		select * from store S left outer join storeFiles F 
  		on S.ssNum = F.ssNum  		
  		where S.memNum=#{memNum}
  	</select>
  	
  	<update id="onUpdate" parameterType="StoreVO">
  		update store set sOn=1 where ssNum=#{ssNum}  	
  	</update>
  	
  	<update id="offUpdate" parameterType="StoreVO">
  		update store set sOn=0 where ssNum=#{ssNum}
  	</update>
  	
  	
  	<select id="checkStore" parameterType="StoreVO" resultType="Integer">
		select count(*) from store where sName=#{sName}  	
  	</select>
  	
     
     <select id="storeList" parameterType="StoreVO" resultMap="storeResult">
     	select * from store S left outer join storeFiles F 
        on S.ssNum = F.ssNum        
        where roadFullAddr LIKE concat('%',#{memId}, '%') and roadFullAddr LIKE concat('%',#{sName},'%');
     </select>
     
     <select id="storeList2" parameterType="StoreVO" resultMap="storeResult">
     	select * from store S left outer join storeFiles F 
        on S.ssNum = F.ssNum        
        where roadFullAddr LIKE concat('%',#{memId}, '%');
     </select>
     
     
  </mapper>

